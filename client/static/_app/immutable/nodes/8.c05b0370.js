import{S as Ae,i as Le,s as Se,k as v,q as j,a as C,y as Z,l as E,m as A,r as B,h,c as D,z as K,n as _,b as H,L as a,A as x,g as W,d as J,B as ee,H as Ue,w as ne,ag as ue,ah as fe,e as we,v as Pe,f as Te,K as te,G as se,P as ke,ai as ye,u as oe}from"../chunks/index.7bf39313.js";import{c as Ce,p as X,g as De}from"../chunks/pocketbase.c6bc3d05.js";import{m as re}from"../chunks/stores.71570215.js";import{t as le}from"../chunks/stores.0b953536.js";import"../chunks/ProgressBar.svelte_svelte_type_style_lang.6842832c.js";import{F as Me}from"../chunks/FileDropzone.8d30152e.js";import{T as Ne,a as ce}from"../chunks/Tab.4aefebba.js";import{C as Oe}from"../chunks/types.88dddc30.js";import{f as Re}from"../chunks/util.8bfa846c.js";function je(s){let e,t;return{c(){e=v("span"),t=j("Profile")},l(l){e=E(l,"SPAN",{});var i=A(e);t=B(i,"Profile"),i.forEach(h)},m(l,i){H(l,e,i),a(e,t)},p:te,d(l){l&&h(e)}}}function Be(s){let e;return{c(){e=j("Email")},l(t){e=B(t,"Email")},m(t,l){H(t,e,l)},d(t){t&&h(e)}}}function Ie(s){let e;return{c(){e=j("Account")},l(t){e=B(t,"Account")},m(t,l){H(t,e,l)},d(t){t&&h(e)}}}function qe(s){let e,t,l,i,d,o,m,n,f;function p(r){s[16](r)}let b={name:"tab1",value:0,$$slots:{default:[je]},$$scope:{ctx:s}};s[1]!==void 0&&(b.group=s[1]),e=new ce({props:b}),ne.push(()=>ue(e,"group",p));function U(r){s[17](r)}let k={name:"tab2",value:1,$$slots:{default:[Be]},$$scope:{ctx:s}};s[1]!==void 0&&(k.group=s[1]),i=new ce({props:k}),ne.push(()=>ue(i,"group",U));function M(r){s[18](r)}let O={name:"tab3",value:2,$$slots:{default:[Ie]},$$scope:{ctx:s}};return s[1]!==void 0&&(O.group=s[1]),m=new ce({props:O}),ne.push(()=>ue(m,"group",M)),{c(){Z(e.$$.fragment),l=C(),Z(i.$$.fragment),o=C(),Z(m.$$.fragment)},l(r){K(e.$$.fragment,r),l=D(r),K(i.$$.fragment,r),o=D(r),K(m.$$.fragment,r)},m(r,u){x(e,r,u),H(r,l,u),x(i,r,u),H(r,o,u),x(m,r,u),f=!0},p(r,u){const w={};u&2097152&&(w.$$scope={dirty:u,ctx:r}),!t&&u&2&&(t=!0,w.group=r[1],fe(()=>t=!1)),e.$set(w);const L={};u&2097152&&(L.$$scope={dirty:u,ctx:r}),!d&&u&2&&(d=!0,L.group=r[1],fe(()=>d=!1)),i.$set(L);const q={};u&2097152&&(q.$$scope={dirty:u,ctx:r}),!n&&u&2&&(n=!0,q.group=r[1],fe(()=>n=!1)),m.$set(q)},i(r){f||(W(e.$$.fragment,r),W(i.$$.fragment,r),W(m.$$.fragment,r),f=!0)},o(r){J(e.$$.fragment,r),J(i.$$.fragment,r),J(m.$$.fragment,r),f=!1},d(r){ee(e,r),r&&h(l),ee(i,r),r&&h(o),ee(m,r)}}}function Fe(s){let e,t,l,i,d,o,m,n,f,p,b,U,k,M,O,r,u,w,L,q;return{c(){e=v("div"),t=v("button"),l=j("RESET PASSWORD"),i=C(),d=v("br"),o=C(),m=v("small"),n=j("A confirmation will be sent to your email."),f=C(),p=v("hr"),b=C(),U=v("button"),k=j("DELETE MY ACCOUNT"),M=C(),O=v("br"),r=C(),u=v("small"),w=j("Permanently remove your record."),this.h()},l(R){e=E(R,"DIV",{class:!0});var g=A(e);t=E(g,"BUTTON",{class:!0,type:!0});var V=A(t);l=B(V,"RESET PASSWORD"),V.forEach(h),i=D(g),d=E(g,"BR",{}),o=D(g),m=E(g,"SMALL",{});var c=A(m);n=B(c,"A confirmation will be sent to your email."),c.forEach(h),f=D(g),p=E(g,"HR",{}),b=D(g),U=E(g,"BUTTON",{class:!0,type:!0});var y=A(U);k=B(y,"DELETE MY ACCOUNT"),y.forEach(h),M=D(g),O=E(g,"BR",{}),r=D(g),u=E(g,"SMALL",{});var S=A(u);w=B(S,"Permanently remove your record."),S.forEach(h),g.forEach(h),this.h()},h(){_(t,"class","btn btn-sm variant-ghost-primary"),_(t,"type","button"),t.disabled=s[5],_(U,"class","btn btn-sm variant-ghost-error"),_(U,"type","button"),U.disabled=s[4],_(e,"class","space-y-4")},m(R,g){H(R,e,g),a(e,t),a(t,l),a(e,i),a(e,d),a(e,o),a(e,m),a(m,n),a(e,f),a(e,p),a(e,b),a(e,U),a(U,k),a(e,M),a(e,O),a(e,r),a(e,u),a(u,w),L||(q=[se(t,"click",s[13]),se(U,"click",s[12])],L=!0)},p(R,g){g&32&&(t.disabled=R[5]),g&16&&(U.disabled=R[4])},i:te,o:te,d(R){R&&h(e),L=!1,ke(q)}}}function Ge(s){let e,t,l,i,d,o,m,n,f,p=s[7](s[9].Email)+"",b,U,k,M,O,r;return{c(){e=v("form"),t=v("label"),l=v("small"),i=j("Email Address"),d=C(),o=v("input"),n=C(),f=v("small"),b=j(p),U=C(),k=v("button"),M=j("CHANGE MY EMAIL"),this.h()},l(u){e=E(u,"FORM",{class:!0,method:!0});var w=A(e);t=E(w,"LABEL",{class:!0});var L=A(t);l=E(L,"SMALL",{});var q=A(l);i=B(q,"Email Address"),q.forEach(h),d=D(L),o=E(L,"INPUT",{class:!0,type:!0,name:!0,placeholder:!0}),n=D(L),f=E(L,"SMALL",{class:!0});var R=A(f);b=B(R,p),R.forEach(h),L.forEach(h),U=D(w),k=E(w,"BUTTON",{class:!0,type:!0});var g=A(k);M=B(g,"CHANGE MY EMAIL"),g.forEach(h),w.forEach(h),this.h()},h(){_(o,"class",m=s[6]([s[9].Email])),_(o,"type","email"),_(o,"name",s[9].Email),_(o,"placeholder","johnchena@chinamail.com"),_(f,"class","text-error-500"),_(t,"class","label"),_(k,"class","btn btn-sm variant-ghost-secondary"),_(k,"type","button"),k.disabled=s[5],_(e,"class","space-y-2 my-4"),_(e,"method","POST")},m(u,w){H(u,e,w),a(e,t),a(t,l),a(l,i),a(t,d),a(t,o),a(t,n),a(t,f),a(f,b),a(e,U),a(e,k),a(k,M),O||(r=[se(k,"click",s[13]),se(e,"submit",ye(s[14]))],O=!0)},p(u,w){w&64&&m!==(m=u[6]([u[9].Email]))&&_(o,"class",m),w&128&&p!==(p=u[7](u[9].Email)+"")&&oe(b,p),w&32&&(k.disabled=u[5])},i:te,o:te,d(u){u&&h(e),O=!1,ke(r)}}}function He(s){let e,t,l,i,d,o,m,n,f,p,b,U,k,M=s[7](s[9].Avatar)+"",O,r,u,w,L,q,R,g,V,c,y,S,N=s[7](s[9].Username)+"",z,G,P,Y,F,ie,me,I=s[0]?.code=="unknown"&&$e(s);return b=new Me({props:{accept:".jpg, .jpeg, .png, .webp, .gif",name:s[9].Avatar,class:"text-sm"}}),b.$on("change",s[10]),{c(){I&&I.c(),e=C(),t=v("form"),l=v("small"),i=j("Change Cover"),d=C(),o=v("div"),m=v("span"),n=v("figure"),f=v("img"),p=C(),Z(b.$$.fragment),U=C(),k=v("small"),O=j(M),r=C(),u=v("label"),w=v("small"),L=v("span"),q=j("Username"),R=C(),g=v("input"),y=C(),S=v("small"),z=j(N),G=C(),P=v("button"),Y=j("UPDATE"),this.h()},l($){I&&I.l($),e=D($),t=E($,"FORM",{class:!0,method:!0});var T=A(t);l=E(T,"SMALL",{});var pe=A(l);i=B(pe,"Change Cover"),pe.forEach(h),d=D(T),o=E(T,"DIV",{class:!0});var ae=A(o);m=E(ae,"SPAN",{});var de=A(m);n=E(de,"FIGURE",{class:!0});var _e=A(n);f=E(_e,"IMG",{class:!0,alt:!0}),_e.forEach(h),de.forEach(h),p=D(ae),K(b.$$.fragment,ae),ae.forEach(h),U=D(T),k=E(T,"SMALL",{class:!0});var be=A(k);O=B(be,M),be.forEach(h),r=D(T),u=E(T,"LABEL",{class:!0});var Q=A(u);w=E(Q,"SMALL",{class:!0});var ge=A(w);L=E(ge,"SPAN",{class:!0});var he=A(L);q=B(he,"Username"),he.forEach(h),ge.forEach(h),R=D(Q),g=E(Q,"INPUT",{class:!0,type:!0,placeholder:!0,name:!0,id:!0}),y=D(Q),S=E(Q,"SMALL",{class:!0});var ve=A(S);z=B(ve,N),ve.forEach(h),Q.forEach(h),G=D(T),P=E(T,"BUTTON",{class:!0,type:!0});var Ee=A(P);Y=B(Ee,"UPDATE"),Ee.forEach(h),T.forEach(h),this.h()},h(){_(f,"class","aspect-square object-cover object-center"),_(f,"alt",""),_(n,"class","avatar flex aspect-square justify-center items-center overflow-hidden bg-surface-400-500-token w-16 h-16 rounded-full"),_(o,"class","inline-flex gap-2 w-full"),_(k,"class","text-error-500"),_(L,"class","whitespace-nowrap"),_(w,"class","inline-flex items-center"),_(g,"class",V=s[6]([s[9].Username,"unknown"])),_(g,"type","text"),_(g,"placeholder","My awesome room"),_(g,"name",s[9].Username),_(g,"id",s[9].Username),g.value=c=s[8]?.username||"",_(S,"class","text-error-500"),_(u,"class","label"),_(P,"class","btn btn-sm variant-filled"),P.disabled=s[3],_(P,"type","submit"),_(t,"class","space-y-2"),_(t,"method","POST")},m($,T){I&&I.m($,T),H($,e,T),H($,t,T),a(t,l),a(l,i),a(t,d),a(t,o),a(o,m),a(m,n),a(n,f),s[15](f),a(o,p),x(b,o,null),a(t,U),a(t,k),a(k,O),a(t,r),a(t,u),a(u,w),a(w,L),a(L,q),a(u,R),a(u,g),a(u,y),a(u,S),a(S,z),a(t,G),a(t,P),a(P,Y),F=!0,ie||(me=se(t,"submit",ye(s[11])),ie=!0)},p($,T){$[0]?.code=="unknown"?I?I.p($,T):(I=$e($),I.c(),I.m(e.parentNode,e)):I&&(I.d(1),I=null),(!F||T&128)&&M!==(M=$[7]($[9].Avatar)+"")&&oe(O,M),(!F||T&64&&V!==(V=$[6]([$[9].Username,"unknown"])))&&_(g,"class",V),(!F||T&256&&c!==(c=$[8]?.username||"")&&g.value!==c)&&(g.value=c),(!F||T&128)&&N!==(N=$[7]($[9].Username)+"")&&oe(z,N),(!F||T&8)&&(P.disabled=$[3])},i($){F||(W(b.$$.fragment,$),F=!0)},o($){J(b.$$.fragment,$),F=!1},d($){I&&I.d($),$&&h(e),$&&h(t),s[15](null),ee(b),ie=!1,me()}}}function $e(s){let e,t=s[0].message+"",l;return{c(){e=v("p"),l=j(t),this.h()},l(i){e=E(i,"P",{class:!0});var d=A(e);l=B(d,t),d.forEach(h),this.h()},h(){_(e,"class","text-error-500")},m(i,d){H(i,e,d),a(e,l)},p(i,d){d&1&&t!==(t=i[0].message+"")&&oe(l,t)},d(i){i&&h(e)}}}function ze(s){let e,t,l,i;const d=[He,Ge,Fe],o=[];function m(n,f){return n[1]===0?0:n[1]===1?1:n[1]===2?2:-1}return~(e=m(s))&&(t=o[e]=d[e](s)),{c(){t&&t.c(),l=we()},l(n){t&&t.l(n),l=we()},m(n,f){~e&&o[e].m(n,f),H(n,l,f),i=!0},p(n,f){let p=e;e=m(n),e===p?~e&&o[e].p(n,f):(t&&(Pe(),J(o[p],1,1,()=>{o[p]=null}),Te()),~e?(t=o[e],t?t.p(n,f):(t=o[e]=d[e](n),t.c()),W(t,1),t.m(l.parentNode,l)):t=null)},i(n){i||(W(t),i=!0)},o(n){J(t),i=!1},d(n){~e&&o[e].d(n),n&&h(l)}}}function Ye(s){let e,t,l,i,d,o,m,n;return m=new Ne({props:{$$slots:{panel:[ze],default:[qe]},$$scope:{ctx:s}}}),{c(){e=v("div"),t=v("h2"),l=j("Edit"),i=C(),d=v("br"),o=C(),Z(m.$$.fragment),this.h()},l(f){e=E(f,"DIV",{class:!0});var p=A(e);t=E(p,"H2",{class:!0});var b=A(t);l=B(b,"Edit"),b.forEach(h),i=D(p),d=E(p,"BR",{}),o=D(p),K(m.$$.fragment,p),p.forEach(h),this.h()},h(){_(t,"class","h4"),_(e,"class","card p-4 max-w-[400px] mx-auto my-4")},m(f,p){H(f,e,p),a(e,t),a(t,l),a(e,i),a(e,d),a(e,o),x(m,e,null),n=!0},p(f,[p]){const b={};p&2097663&&(b.$$scope={dirty:p,ctx:f}),m.$set(b)},i(f){n||(W(m.$$.fragment,f),n=!0)},o(f){J(m.$$.fragment,f),n=!1},d(f){f&&h(e),ee(m)}}}function Ve(s,e,t){let l,i,d;Ue(s,Ce,c=>t(8,d=c));let o=0;var m=(c=>(c.Email="email",c.Username="username",c.Password="password",c.PasswordConfirm="passwordConfirm",c.Avatar="avatar",c))(m||{});let n,f=!1,p;const b=(c="unknown",y="")=>t(0,p={code:c,message:y}),U=c=>{const y=c.target,S=y?.files!=null&&y?.files.length>0?y.files[0]:null;if(S){const N=new FileReader;N.addEventListener("load",()=>{n&&N.result&&n.setAttribute("src",N.result)}),N.readAsDataURL(S);return}},k=async c=>{if(!d)return b("unknown","Authentication failed, Please sign in.");const y=c.target,S=new FormData(y);S.get("avatar").size<1e3&&S.delete("avatar");const z=S.get("username")?.toString();if(!z||z.length<3)return b("username","Username must have at least 3 letter.");try{t(3,f=!0);const G=await X.collection("users").update(d.id,S),P={message:"Successfully updated",background:"variant-filled-success"};le.trigger(P),G&&re.close()}catch(G){const P=G.response.data,Y=["username","avatar"];if(P!==void 0&&Y.includes(Object.keys(P).pop()||""))for(const F of Y)P[F]!==void 0&&(P[F].code==="validation_not_unique"&&(P[F].message="User already exists."),b(F,P[F].message));else b("unknown","Failed to update user.")}finally{t(3,f=!1)}};let M=!1;const O=async()=>{if(!(!d?.id||(re.clear(),!await Re())))try{if(t(4,M=!0),!await X.collection(Oe.User).delete(d.id,{}))throw new Error("Failed deleting user.");X.authStore.clear(),De("/")}catch(y){const S={message:y.message,background:"variant-filled-error"};le.trigger(S)}finally{t(4,M=!1)}};let r=!1;const u=async()=>{try{t(5,r=!0);const c=await X.collection("users").requestPasswordReset(d?.email);console.log({res:c});const y={message:"Password reset email has been sent.",background:"variant-filled-success"};le.trigger(y),re.close()}catch(c){const y=c.response.data,S=["email","password"];if(y!==void 0&&S.includes(Object.keys(y).pop()||""))for(const N of S)y[N]!==void 0&&b(N,y[N].message);else b("unknown","Failed to reset password")}finally{t(5,r=!1)}};let w=!1;const L=async c=>{if(!d)return b("unknown","Authentication failed, Please sign in.");const y=c.target,N=new FormData(y).get("email")?.toString();if(!N||N.length<3)return b("username","Email address must have at least 3 letter.");try{w=!0;const z=await X.collection("users").requestEmailChange(N),G={message:"Confirmation message has been sent to your new email.",background:"variant-filled-success"};le.trigger(G),re.close()}catch(z){const G=z.response.data,P=["email","password"];if(G!==void 0&&P.includes(Object.keys(G).pop()||""))for(const Y of P)G[Y]!==void 0&&b(Y,G[Y].message);else b("unknown","Failed to change email")}finally{w=!1}};function q(c){ne[c?"unshift":"push"](()=>{n=c,t(2,n)})}function R(c){o=c,t(1,o)}function g(c){o=c,t(1,o)}function V(c){o=c,t(1,o)}return s.$$.update=()=>{s.$$.dirty&1&&t(7,l=c=>p?.code&&p.code==c?p.message:""),s.$$.dirty&1&&t(6,i=c=>`input  ${p?.code&&c.includes(p.code)?"input-error":""}`)},[p,o,n,f,M,r,i,l,d,m,U,k,O,u,L,q,R,g,V]}class st extends Ae{constructor(e){super(),Le(this,e,Ve,Ye,Se,{})}}export{st as component};
