import{S as W,i as X,s as Y,k as j,l as z,m as F,h,n as f,b as I,G as _,K as B,P as N,ae as G,E as C,J as U,Q as k,a9 as q,q as Z,ab as x,r as p,L,u as $,V as M,M as tt,R as et,U as at,F as rt}from"./index.7bf39313.js";import{w as T}from"./index.418f7e58.js";import{c as st,e as O}from"./constant.407e1c3c.js";import"./singletons.61463517.js";import{C as lt}from"./types.88dddc30.js";import{p as y}from"./pocketbase.c6bc3d05.js";import{t as S}from"./stores.0b953536.js";import{l as it}from"./ProgressBar.svelte_svelte_type_style_lang.6842832c.js";function ot(a){let t,e,s=String(a[1]).substring(0,2).toUpperCase()+"",o,c;return{c(){t=q("svg"),e=q("text"),o=Z(s),this.h()},l(n){t=x(n,"svg",{class:!0,viewBox:!0});var l=F(t);e=x(l,"text",{x:!0,y:!0,"dominant-baseline":!0,"text-anchor":!0,"font-weight":!0,"font-size":!0,class:!0});var i=F(e);o=p(i,s),i.forEach(h),l.forEach(h),this.h()},h(){f(e,"x","50%"),f(e,"y","50%"),f(e,"dominant-baseline","central"),f(e,"text-anchor","middle"),f(e,"font-weight","bold"),f(e,"font-size",150),f(e,"class",c="avatar-text "+a[2]),f(t,"class","avatar-initials w-full h-full"),f(t,"viewBox","0 0 512 512")},m(n,l){I(n,t,l),L(t,e),L(e,o)},p(n,l){l&2&&s!==(s=String(n[1]).substring(0,2).toUpperCase()+"")&&$(o,s),l&4&&c!==(c="avatar-text "+n[2])&&f(e,"class",c)},d(n){n&&h(t)}}}function nt(a){let t,e,s,o,c,n,l,i,u=[{class:e="avatar-image "+ut},{style:s=a[8].style??""},{src:o=a[0]},{alt:c=a[8].alt||""},a[7]()],m={};for(let d=0;d<u.length;d+=1)m=C(m,u[d]);return{c(){t=j("img"),this.h()},l(d){t=z(d,"IMG",{class:!0,style:!0,src:!0,alt:!0}),this.h()},h(){M(t,m)},m(d,g){I(d,t,g),l||(i=[tt(n=a[4].call(null,t,a[5])),_(t,"error",a[19])],l=!0)},p(d,g){M(t,m=et(u,[{class:e},g&256&&s!==(s=d[8].style??"")&&{style:s},g&1&&!at(t.src,o=d[0])&&{src:o},g&256&&c!==(c=d[8].alt||"")&&{alt:c},d[7]()])),n&&rt(n.update)&&g&32&&n.update.call(null,d[5])},d(d){d&&h(t),l=!1,N(i)}}}function ct(a){let t,e,s,o;function c(i,u){return i[0]?nt:ot}let n=c(a),l=n(a);return{c(){t=j("figure"),l.c(),this.h()},l(i){t=z(i,"FIGURE",{class:!0,"data-testid":!0});var u=F(t);l.l(u),u.forEach(h),this.h()},h(){f(t,"class",e="avatar "+a[6]),f(t,"data-testid","avatar")},m(i,u){I(i,t,u),l.m(t,null),s||(o=[_(t,"click",a[15]),_(t,"keydown",a[16]),_(t,"keyup",a[17]),_(t,"keypress",a[18])],s=!0)},p(i,[u]){n===(n=c(i))&&l?l.p(i,u):(l.d(1),l=n(i),l&&(l.c(),l.m(t,null))),u&64&&e!==(e="avatar "+i[6])&&f(t,"class",e)},i:B,o:B,d(i){i&&h(t),l.d(),s=!1,N(o)}}}let dt="flex aspect-square text-surface-50 font-semibold justify-center items-center overflow-hidden isolate",ut="w-full h-full object-cover";function ft(a,t,e){let s;const o=["initials","fill","src","fallback","action","actionParams","background","width","border","rounded","shadow","cursor"];let c=G(t,o),{initials:n="AB"}=t,{fill:l="fill-token"}=t,{src:i=""}=t,{fallback:u=""}=t,{action:m=()=>{}}=t,{actionParams:d=""}=t,{background:g="bg-surface-400-500-token"}=t,{width:P="w-16"}=t,{border:E=""}=t,{rounded:w="rounded-full"}=t,{shadow:A=""}=t,{cursor:R=""}=t;function D(){return delete c.class,c}function H(r){k.call(this,a,r)}function J(r){k.call(this,a,r)}function K(r){k.call(this,a,r)}function Q(r){k.call(this,a,r)}const V=()=>e(0,i=u);return a.$$set=r=>{e(8,t=C(C({},t),U(r))),e(20,c=G(t,o)),"initials"in r&&e(1,n=r.initials),"fill"in r&&e(2,l=r.fill),"src"in r&&e(0,i=r.src),"fallback"in r&&e(3,u=r.fallback),"action"in r&&e(4,m=r.action),"actionParams"in r&&e(5,d=r.actionParams),"background"in r&&e(9,g=r.background),"width"in r&&e(10,P=r.width),"border"in r&&e(11,E=r.border),"rounded"in r&&e(12,w=r.rounded),"shadow"in r&&e(13,A=r.shadow),"cursor"in r&&e(14,R=r.cursor)},a.$$.update=()=>{e(6,s=`${dt} ${g} ${P} ${E} ${w} ${A} ${R} ${t.class??""}`)},t=U(t),[i,n,l,u,m,d,s,D,t,g,P,E,w,A,R,H,J,K,Q,V]}class Pt extends W{constructor(t){super(),X(this,t,ft,ct,Y,{initials:1,fill:2,src:0,fallback:3,action:4,actionParams:5,background:9,width:10,border:11,rounded:12,shadow:13,cursor:14})}}const gt=T(null);gt.subscribe;const v=T({loading:!1,error:void 0,data:[]}),Et=async()=>{try{v.set({loading:!0,error:void 0,data:[]});const a=await y.collection(lt.Room).getFullList();if(!a)throw new Error("Failed loading rooms.");v.set({loading:!1,error:void 0,data:a.sort((t,e)=>+(t.slug>e.slug))})}catch(a){if(a.isAbort)return;v.update(e=>({loading:!1,error:a,data:e.data}));const t={message:a.message,background:"variant-filled-error"};S.trigger(t)}},wt=async a=>{try{if(!await y.collection("rooms").delete(a,{}))throw new Error("Failed deleting room.");v.update(e=>{const s=[...e.data],o=s.findIndex(c=>c.id==a);return o!==-1&&s.splice(o,1),{error:void 0,data:s,loading:!1}})}catch(t){const e={message:t.message,background:"variant-filled-error"};S.trigger(e)}},b=T({loading:!1,error:void 0,data:[]}),At=async a=>{try{b.set({loading:!0,error:void 0,data:[]});const t=await y.send(`${O}?roomSlug=${a}`,{method:"GET"});if(!t)throw new Error("Failed loading participants.");b.set({loading:!1,error:void 0,data:t})}catch(t){if(t.isAbort)return;b.update(s=>({loading:!1,error:t,data:s.data}));const e={message:t.message,background:"variant-filled-error"};S.trigger(e)}},Rt=async a=>{try{b.update(e=>({...e,loading:!0}));const t=await y.send(`${O}/${a}`,{method:"GET"});if(!t)throw new Error("Failed loading participants.");b.update(e=>{const s=[...e.data],o=s.findIndex(c=>c.id==a);return o===-1?s.push(t):s[o]={...t,roomSlug:s[o].roomSlug},{error:void 0,data:s,loading:!1}})}catch(t){if(t.isAbort)return;b.set({loading:!1,error:t,data:[]});const e={message:t.message,background:"variant-filled-error"};S.trigger(e)}},Ft=it("currentRoom",st);export{Pt as A,Et as a,At as b,Ft as c,wt as d,Rt as e,gt as m,b as p,v as r};
